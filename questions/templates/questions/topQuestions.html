{% extends "questions/base.html" %}

{% block title %}
<title>Новые вопросы</title>
{% endblock %}

{% block content %}
<div class="question-container">
    <div class="main-header">
        <h2>Популярные вопросы</h2>
        <a href="{% url 'questions:main_page' %}" class="hot-questions">Новые вопросы</a>
    </div>

    <div class="questions">
        {% for q in questions %}
        <div class="question">
            <div class="question-left">
                <div class="user-avatar">
                    <img src="{{ q.avatar }}" alt="Аватар" class="avatar-img">
                </div>
                <span class="username-question">{{ q.username }}</span>
                <div class="vote-buttons">
                    <button class="vote-up">↑</button>
                    <span class="rating">{{ q.questionRating }}</span>
                    <button class="vote-down">↓</button>
                </div>
            </div>

            <div class="question-right">
                <a href="{% url 'questions:question' q.id %}" class="question-title" onclick="location.href='question.html'">{{ q.questionTitle }}</a>
                <p class="question-text">{{ q.questionText }}</p>
                <div class="question-footer">
                    <a href="{% url 'questions:question' q.id %}" class="answers-link">ответы ({{ q.answersCount }})</a>
                    <div class="tags">
                        <span class="tags-label">Теги:</span>
                        {% for tag in q.tags %}
                            {% for t in topTags %}
                                {% if t.tag == tag %}
                                    <a href="{% url 'questions:tag' t.id %}" class="tag">{{ tag }}</a>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="pagination">
        {% if questions.has_previous %}
            {% if questions.previous_page_number != 1 %}
            <a href="?page=1" class="page-link">1</a>
            {% endif %}
            {% if questions.previous_page_number > 2 %}
                <span class="page-dots">...</span>
            {% endif %}
            <a href="?page={{ questions.previous_page_number }}" class="page-link">{{ questions.previous_page_number }}</a>
        {% endif %}

        {% for num in questions.paginator.page_range %}
            {% if questions.number == num %}
                <a href="?page={{ num }}" class="page-link-active">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if questions.has_next %}
            {% if questions.next_page_number != questions.paginator.num_pages %}
            <a href="?page={{ questions.next_page_number }}" class="page-link">{{ questions.next_page_number }}</a>
            {% endif %}
            {% if questions.paginator.num_pages > questions.next_page_number|add:1 %}
                <span class="page-dots">...</span>
            {% endif %}
            <a href="?page={{ questions.paginator.num_pages }}" class="page-link">{{ questions.paginator.num_pages }}</a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block topUsers %}
<h3 class="sidebar-title">Лучшие пользователи</h3>
{% for user in topUsers %}
    <div class="user-item">
        <span class="user-rank">{{ user.rank }}</span>
        <span class="user-name">{{ user.username }}</span>
    </div>
{% endfor %}
{% endblock %}

{% block topTags %}
<h3 class="sidebar-title">Популярные теги</h3>
<div class="tags">
    {% for tag in topTags|slice:":7" %}
        <a href="{% url 'questions:tag' tag.id %}" class="tag">{{ tag.tag }}</a>
    {% endfor %}
</div>
{% endblock %}
